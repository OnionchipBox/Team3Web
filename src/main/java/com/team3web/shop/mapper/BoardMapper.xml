<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">




<!-- QnA 게시판 부분  -->
<mapper namespace="com.team3web.shop.mapper.BoardMapper">

<!-- 게시판 저장 -->
<insert id="qna_in">
	insert into qna(qna_no,qid,qtitle,qpw,qcont,qfile,qref,qstep,qlevel,qdate) values(qna_no_seq.nextval,#{qid},#{qtitle},#{qpw},#{qcont},#{qfile},qna_no_seq.nextval,0,0,sysdate)
</insert>


<!-- 시퀀스 번호값 구함 -->
   <select id="qnaNoSeq_Find" resultType="int">
     select qna_no_seq.nextval from dual
   </select>
   
<!-- 검색전후 레코드 개수 -->
	<select id="qna_count" resultType="int"> <!-- resultType은 반환타입 -->
	select count(qna_no) from qna <!-- count()는 레코드 개수를 구하는 오라클 함수 -->
	<!-- 검색 조건 -->
	<where>
		<if test="find_field ==''"></if> <!-- 검색을 안 한 경우 - > 총 레코드 개수 -->
		<if test="find_field =='qtitle'"> <!-- 글 제목으로 검색하는 경우 -->
		qtitle like #{find_name}
		</if>
		<if test="find_field == 'qcont'"> <!--글 내용으로 검색 경우-->
			qcont like #{find_name}
		</if>
	</where>
	</select>

<!-- 검색전후 목록 -->	

	<select id="qna_list" parameterType="PageVO" resultType="QnAVO">
	select * from(
	select rowNum rNum, qna_no, qid, qtitle, qref,qstep,qlevel,qdate from(select * from qna
	<!-- 검색 조건 -->
	<where>
		<if test="find_field ==''"></if> <!-- 검색을 안 한 경우 - > 총 레코드 개수 -->
		<if test="find_field =='qtitle'"> <!-- 글 제목으로 검색하는 경우 -->
		qtitle like #{find_name}
		</if>
		<if test="find_field == 'qcont'"> <!--글 내용으로 검색 경우-->
			qcont like #{find_name}
		</if>
	</where>
	order by qref desc, qlevel asc)) where rNum &gt;=#{startrow}
	and rNum &lt;=#{endrow}
	</select>


<!-- 내용 보기 -->
	<select id="qna_cont" resultType="QnAVO">
	select * from qna where qna_no=#{qna_no}
	</select>

<!-- 답변 레벨 증가 -->
	<update id="levelUp">
	update qna set qlevel=qlevel+1 where qref=#{qref}
	and qlevel > #{qlevel}
	</update>
	
	<!-- 답변 저장 -->
	<insert id="qna_re">
	insert into qna(qna_no,qid,qtitle,qpw,qcont,qref,qstep,qlevel,qdate) values(qna_no_seq.nextval,#{qid},#{qtitle},#{qpw},#{qcont},#{qref},#{qstep}+1,#{qlevel}+1,sysdate)
	</insert>


<!-- QnA게시판 수정 -->
	<update id="qna_edit"> 
	update qna set qid=#{qid},qtitle=#{qtitle},qcont=#{qcont},qfile=#{qfile} where qna_no=#{qna_no}
	</update>

<!-- QnA게시판 삭제 -->
	<delete id="qna_del">
	delete from qna where qna_no=#{qna_no}
	</delete>	
	
</mapper>